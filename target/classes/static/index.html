<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Gestão de Tarefas - Frontend</title>
  <style>
    :root{
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
      --primary: #2563eb;
      --primary-600: #1d4ed8;
      --primary-50: #eff6ff;
      --success: #16a34a;
      --warning: #f59e0b;
      --danger: #dc2626;
      --shadow: 0 6px 20px rgba(2,6,23,0.08);
      --radius: 12px;
    }

    @media (prefers-color-scheme: dark) {
      :root{
        --bg: #0b1220;
        --card-bg: #0f172a;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --border: #1f2937;
        --primary: #3b82f6;
        --primary-600: #2563eb;
        --primary-50: #0b1730;
        --success: #22c55e;
        --warning: #fbbf24;
        --danger: #ef4444;
        --shadow: 0 6px 20px rgba(0,0,0,0.35);
      }
    }

    /* Layout base */
    html, body { height: 100%; }
    body {
      margin: 0;
      padding: 24px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
      background: radial-gradient(1200px 600px at 10% -10%, #dbeafe40 0%, #fff0 60%) fixed,
                  radial-gradient(1200px 600px at 110% 10%, #e9d5ff40 0%, #fff0 60%) fixed,
                  var(--bg);
      color: var(--text);
      max-width: 1100px;
      margin-inline: auto;
      line-height: 1.4;
    }

    h1 {
      margin: 0 0 18px 0;
      font-weight: 800;
      letter-spacing: -0.02em;
      font-size: clamp(24px, 2.6vw, 34px);
      color: var(--text);
    }

    h3 {
      margin: 0 0 12px 0;
      font-weight: 700;
      letter-spacing: -0.01em;
      color: var(--text);
    }

    /* Card do formulário */
    #form {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 10px 14px;
      align-items: start;
      margin-bottom: 12px;
    }

    label {
      margin-top: 8px;
      color: var(--muted);
      font-weight: 600;
      user-select: none;
    }

    input, select, textarea {
      appearance: none;
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #ffffff;
      color: var(--text);
      outline: none;
      transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
    }

    textarea { min-height: 90px; resize: vertical; }

    input:focus, select:focus, textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px color-mix(in srgb, var(--primary) 18%, transparent);
      background: var(--primary-50);
    }

    /* Botões */
    button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border: 1px solid color-mix(in srgb, var(--primary) 35%, var(--border));
      border-radius: 10px;
      background: linear-gradient(180deg, color-mix(in srgb, var(--primary) 14%, #fff) 0%, var(--primary) 0%) no-repeat,
                  #ffffff;
      color: #fff;
      font-weight: 700;
      letter-spacing: .01em;
      cursor: pointer;
      transition: transform .06s ease, box-shadow .2s ease, opacity .2s ease, background .2s ease, border-color .2s ease, color .2s ease;
      box-shadow: 0 3px 10px rgba(37, 99, 235, .18);
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      margin-right: 10px;
    }

    button:hover {
      filter: saturate(1.05);
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(37,99,235,.22);
    }

    button:active { transform: translateY(0px) scale(.98); }

    /* Segundo botão do form vira "secundário" */
    #form button + button {
      background: #ffffff;
      color: var(--text);
      border-color: var(--border);
      box-shadow: 0 2px 8px rgba(2,6,23,0.06);
    }
    #form button + button:hover {
      border-color: color-mix(in srgb, var(--primary) 35%, var(--border));
      box-shadow: 0 6px 16px rgba(2,6,23,0.12);
    }

    /* Tabela em "card" */
    .table-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    #tasksTable {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      display: block;          /* torna responsivo em telas pequenas */
      max-width: 100%;
      overflow-x: auto;
      white-space: nowrap;
    }

    #tasksTable thead th {
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, color-mix(in srgb, var(--primary) 8%, #fff), #f8fafc);
      color: #0f172a;
      text-align: left;
      font-weight: 800;
      letter-spacing: .02em;
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      z-index: 1;
    }

    #tasksTable tbody td {
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      color: var(--text);
      white-space: normal;
    }

    #tasksTable tbody tr:nth-child(odd) td {
      background: color-mix(in srgb, var(--bg) 70%, #fff);
    }

    #tasksTable tbody tr:hover td {
      background: color-mix(in srgb, var(--primary-50) 40%, #fff);
    }

    /* Botões de ação na tabela */
    #tasksTable td button {
      padding: 8px 12px;
      font-weight: 700;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #ffffff;
      color: var(--text);
      box-shadow: 0 2px 8px rgba(2,6,23,0.06);
      margin-right: 6px;
    }
    #tasksTable td button:hover {
      border-color: color-mix(in srgb, var(--primary) 35%, var(--border));
      box-shadow: 0 6px 16px rgba(2,6,23,0.12);
    }
    /* último botão da célula (geralmente "Excluir") fica em vermelho */
    #tasksTable td button:last-child {
      background: color-mix(in srgb, var(--danger) 14%, #fff);
      color: #991b1b;
      border-color: color-mix(in srgb, var(--danger) 32%, var(--border));
    }
    #tasksTable td button:last-child:hover {
      background: color-mix(in srgb, var(--danger) 22%, #fff);
      color: #7f1d1d;
    }

    /* Utilidades */
    .muted { color: var(--muted); }
    .spacer { height: 10px; }

    /* Responsividade */
    @media (max-width: 720px) {
      body { padding: 18px 14px; }
      .form-row {
        grid-template-columns: 1fr;
      }
      label { margin-top: 0; }
      #form { padding: 14px; }
      #tasksTable thead th, #tasksTable tbody td { padding: 10px 12px; }
      button { width: 100%; margin: 8px 0 0; }
      #form button { width: auto; margin-right: 10px; }
    }
  </style>
</head>
<body>
  <h1>Gestão de Tarefas</h1>

  <div id="form">
    <h3>Criar / Editar Tarefa</h3>
    <div class="form-row"><label for="title">Título</label><input id="title" placeholder="Ex.: Comprar mantimentos"></div>
    <div class="form-row"><label for="description">Descrição</label><textarea id="description" placeholder="Detalhes da tarefa"></textarea></div>
    <div class="form-row"><label for="dueDate">Due Date</label><input id="dueDate" type="date"></div>
    <div class="form-row">
      <label for="status">Status</label>
      <select id="status">
        <option>TODO</option>
        <option>IN_PROGRESS</option>
        <option>DONE</option>
      </select>
    </div>
    <div class="form-row">
      <label for="priority">Priority</label>
      <select id="priority">
        <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
      </select>
    </div>
    <button onclick="createOrUpdate()">Salvar</button>
    <button onclick="clearForm()">Limpar</button>
  </div>

  <div style="display:flex;align-items:center;gap:10px;margin:6px 0 8px;">
    <h3 style="margin:0;">Lista de Tarefas</h3>
    <button onclick="getTasks()" title="Recarregar a lista">Atualizar</button>
  </div>

  <table id="tasksTable" aria-label="Tabela de tarefas">
    <thead>
      <tr>
        <th>ID</th><th>Título</th><th>Descrição</th><th>Due</th><th>Status</th><th>Priority</th><th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const API = '/api/tasks';

async function getTasks() {
  const res = await fetch(API);
  const tasks = await res.json();
  const tbody = document.querySelector('#tasksTable tbody');
  tbody.innerHTML = '';
  tasks.forEach(t => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${t.id ?? ''}</td>
      <td>${escapeHtml(t.title ?? '')}</td>
      <td>${escapeHtml(t.description ?? '')}</td>
      <td>${t.dueDate ?? ''}</td>
      <td>${t.status ?? ''}</td>
      <td>${t.priority ?? ''}</td>
      <td>
        <button onclick="editTask(${t.id})">Editar</button>
        <button onclick="deleteTask(${t.id})">Excluir</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function escapeHtml(text) {
  return text.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

async function createOrUpdate() {
  const id = document.getElementById('taskId').value;
  const body = {
    title: document.getElementById('title').value,
    description: document.getElementById('description').value,
    dueDate: document.getElementById('dueDate').value || null,
    status: document.getElementById('status').value,
    priority: parseInt(document.getElementById('priority').value)
  };

  if (!body.title) { alert('Título é obrigatório'); return; }

  if (id) {
    const res = await fetch(API + '/' + id, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    if (res.ok) { clearForm(); getTasks(); } else { alert('Erro ao atualizar'); }
  } else {
    const res = await fetch(API, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    if (res.ok) { clearForm(); getTasks(); } else { alert('Erro ao criar'); }
  }
}

async function editTask(id) {
  const res = await fetch(API + '/' + id);
  if (!res.ok) { alert('Tarefa não encontrada'); return; }
  const t = await res.json();
  document.getElementById('taskId').value = t.id;
  document.getElementById('title').value = t.title || '';
  document.getElementById('description').value = t.description || '';
  document.getElementById('dueDate').value = t.dueDate || '';
  document.getElementById('status').value = t.status || 'TODO';
  document.getElementById('priority').value = t.priority || 3;
}

async function deleteTask(id) {
  if (!confirm('Confirma exclusão?')) return;
  const res = await fetch(API + '/' + id, { method: 'DELETE' });
  if (res.status === 204) { getTasks(); } else { alert('Erro ao deletar'); }
}

function clearForm() {
  document.getElementById('taskId').value = '';
  document.getElementById('title').value = '';
  document.getElementById('description').value = '';
  document.getElementById('dueDate').value = '';
  document.getElementById('status').value = 'TODO';
  document.getElementById('priority').value = '3';
}

window.onload = () => { getTasks(); };
</script>